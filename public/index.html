<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>PIX Mercado Pago</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 400px; margin: 40px auto; text-align: center; }
    input, button { padding: 10px; margin: 10px; width: 90%; }
    #qr img { margin-top: 20px; max-width: 300px; }
    #pixCode { margin-top: 10px; word-wrap: break-word; font-size: 14px; color: #333; }
  </style>
</head>
<body>
  <h1>Gerar PIX Sandbox</h1>

  <input type="number" id="amount" placeholder="Valor (R$)" step="0.01" />
  <button onclick="gerarPix()">Gerar QR</button>

  <div id="qr"></div>
  <p id="pixCode"></p>
  <button id="copiar" style="display:none;" onclick="copiarPix()">Copiar C처digo PIX</button>

  <script>
    async function gerarPix() {
      const amount = document.getElementById("amount").value;
      if (!amount) return alert("Digite um valor!");

      try {
        const res = await fetch("/create-pix", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ amount, description: "Teste VIP", email: "teste@cliente.com" })
        });

        const data = await res.json();

        if (data.error) {
          alert("Erro: " + data.error);
          return;
        }

        // Exibe o QR code
        document.getElementById("qr").innerHTML = `<img src="data:image/png;base64,${data.qr_code_base64}" />`;

        // Mostra o c처digo copia e cola
        document.getElementById("pixCode").innerText = data.qr_code;

        // Mostra bot찾o de copiar
        document.getElementById("copiar").style.display = "inline-block";
        window.qrString = data.qr_code;
      } catch (err) {
        alert("Erro ao gerar PIX: " + err.message);
      }
    }

    function copiarPix() {
      navigator.clipboard.writeText(window.qrString)
        .then(() => alert("C처digo PIX copiado!"))
        .catch(() => alert("Falha ao copiar."));
    }
  </script>
</body>
</html>
